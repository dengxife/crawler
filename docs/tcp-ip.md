# 网络协议
## 基础概念

请求过程**

```mermaid
graph LR
A[浏览器输入域名] --> B[NDS服务器查询域名对应的IP地址并返回给浏览器]
B --> C[浏览器拿到IP地址后与WEB服务器建立TCP连接]
C --> D[浏览器向WEB服务器发起HTTP请求]
D --> F[WEB服务器向浏览器返回HTML]
```

**IP**

IPv4地址格式：`211.161.170.115` ，这是一个32位的2进制

IP分为动态IP、静态IP，绝大部分用户使用的是动态IP，一段时间后会被运营商收回，重新分配。

**url协议**

url格式：`http://www.example.com:80/path/to/file.html?key1=value1&key2=value2#link`

`http://` 协议

`www.example.com` 域名

`:80` 端口

`/path/to/file.html` 路径

`?key1=value1&key2=value2` 参数

`#link` 锚点

**url的绝对路径与相对路径**

如 `http://www.example.com/path` 的路径资源中有一段跳转的代码  `href='/commond/user'` 。

`/commond/user` 最终的url是 `http://www.example.com/commond/user`

`commond/user` 最终的url是 `http://www.example.com/path/commond/user`

## 七层网络协议模型

标准的七层网络协议

```mermaid
graph LR
A[应用层] --> B[表示层]
B --> C[会话层]
C --> D[传输层]
D --> F[网络层]
F --> G[数据链路层]
G --> H[物理层]
```

常用的五层网络协议

```mermaid
graph LR
A[应用层] --> B[传输层]
B --> C[网络层]
C --> D[数据链路层]
D --> F[物理层]
```

**应用层协议**

Http、ftp、pop3、DNS

**传输层**

TCP、UDP

**网络层**

ICMP、IP、IGMP

**数据链路层**

ARP、RARP

**物理层**

物理传输介质

### 五层常用网络协议层中数据流动

**应用层协议** [应用程序，如浏览器实现了http协议]

Http、ftp、pop3、DNS

**传输层** [对数据进行包装]

TCP协议：保证数据的有序、完整性

UDP协议：不对数据进行效验，传输速度快

**网络层** [如路由器]

ICMP

IP协议：

IGMP

**数据链路层** [如交换机]

ARP、RARP

**物理层** [如双绞线、集线器]

物理传输介质

#### 数据流动

```mermaid
graph LR
	A1[应用层] --> B1[传输层]
	B1 --> C1[网络层]
	C1 --> D1[数据链路层]
	D1 --> E1[物理层]
	E1 ==客户端传输到服务端==> A2
	A2[物理层] --> B2[数据链路层]
	B2 --> C2[网络层]
	C2 --> D2[传输层]
	D2 --> E2[应用层]
	
```

数据在客户端是从上层往下层逐层封装传输，到服务端后是从下层往上层逐层解码传输

集线器、路由器、操作系统都已经实现了各层的协议，通过调用接口使用。网络编程的接口就是**socket编程**。

## TCP/IP协议

IP地址：是逻辑地址，是可以修改变化的

IP协议：将多个数据包的交换网络连接起来，在源地址与目标地址之间传输数据包。负责将数据片段贴上标签，成为数据包（标签包括源IP地址、目标IP地址）这些标签决定数据传输的路径。

TCP协议：

1. 数据发送前，客户端和服务端机器的内存中保存一份关于对方的信息，如IP地址、端口号等。
2. 处理IP层或以下层的丢包、重复、错误信息，在连接建立中，双方需要交换一些连接参数，这些参数可以放在TCP头部。
3. 面向连接、可靠、基于字节流的传输层协议。负责将要传输的数据分解成一定长度的片段。采用三次握手建立一个连接，采用4次挥手关闭一个连接。